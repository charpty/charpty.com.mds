今天说一个简单的Nginx宏

在Nginx中提供了一个将单个字符转换为小写的宏
```
#define ngx_tolower(c)      (u_char) ((c >= 'A' && c <= 'Z') ? (c | 0x20) : c)
```
逻辑比较简单，如果是属于大写字母，则通过位运算得到对应小写字母，如果不是则返回原字符，关键在于这个位运算为什么能返回对应的小写字母。
大小字母A的ASCII为65，小写字母a的ASCII为97，实际上其实大写字母加上32就是对应的小写字母了，为什么Nginx里要这么写呢

我们先来手动验证一下```c|0x20```这个表达式能不能将A转换为a：

```
// A -> 65(10) -> 0100 0001(2) -> 41(16)
//                |按位或
// 				  0010 0000(2) -> 0110 0001(2) -> 61(16) -> 97(10) -> a
```
实践证明，是可行的。

其实道理十分简单，把第6位置1，不就是等于加上2的5次方，也就是加上32，为什么不直接写加上32呢？因为位运算的执行效率要高于执行加法。


同样的
```
// 减32
#define ngx_toupper(c)      (u_char) ((c >= 'a' && c <= 'z') ? (c & ~0x20) : c)
```

今天是2016年第一天，新年快乐，早点休息。