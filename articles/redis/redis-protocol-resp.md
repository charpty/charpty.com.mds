> 笔者博客地址： https://charpty.com/blog


为了大家看整体源码方便，我将加上了完整注释的代码传到了我的github上供大家直接下载：
> https://github.com/charpty/redis4.0-source-reading

```RESP```全称为```Redis Serialization Protocol```，是Redis的客户端与服务端进行通信的标准协议。客户端只要按照规则发送简单的几行字符串，服务端的响应同样也是简单的几行字符串，```RESP```看名字就是为```Redis```量身定制的，但是官方也建议可以扩展到其它场景使用。 

```RESP```协议的设计思想依旧和```Redis```一样，追求极致的简单，追求快。所以```RESP```协议具备容易理解、容易解析、容易实现的特点。 ```RESP```使得用户可以使用任何流传输协议连接客户端，比如```TCP```、```Unix Socket```、```Linux Pipeline```，也就是说仅仅使用```nc```命令就可以连接```Redis```并进行日常操作。

## 协议通信模型
```Redis```的通信模型很简单：**客户端发送一个指令给服务端，服务端接收指令并响应结果给客户端**。这是非常简洁的通信模型，可以说就是简单的**一问一答**。  

但由于```Redis```的特性，有两点例外  
1. 多问一答：```Redis```支持使用```pipeline```将多个指令一次送给服务器并等待响应  
2. 订阅发布：```Redis```也支持消息订阅-发布模型，这时需要服务端主动给客户端发送消息

## 传输格式
作为一个数据传输协议，```RESP```可以传输以下5种格式的数据   
1. ```Simple Strings```：一行简单字符串如```+OK```，一般为服务器响应OK等字符串  
2. ```Integers```：一个整数，很多命令如```INCR```, ```LLEN```会返回整数  
3. ```Bulk Strings```：其实就是带有前缀参数的字符串，前缀表明了字符串的长度，```L-V```形式，只要读L就知道V的长度  
4. ```Arrays```：这个就是将多种格式打包形成一个数组集合，一次传输多个上述格式的数组  
5. ```Errors```：特殊情况，这是服务端响应的错误信息，一般也为一行字符串如```-WRONGTYPE Operation ...```     

在```RESP```协议中规定，使用第一个字节来区分数据的传输格式，第一个字节的内容代表了后面的数据是何种格式，分别用```'+'```、```':'```、```'$'```、```'*'```、```'-'```来表示上述5种数据传输格式。传输数据都统一使用换行符```"\r\n" (CRLF)```结尾，当然也使用```CRLF```表示另一行。

客户端向```Redis```服务端发送消息时使用的是```Arrays```格式，也就是一个数组集合，数组里元素则都是```Bulk Strings```，也就是```L-V```（字符长度+字符值）形式的字符串。  
```Redis```服务端响应客户端请求时可以发送的格式就多了，以上5种格式都有可能，这根据具体命令的实现而定。

### Simple Strings
```RESP```协议使用第一个字节区分传输格式，而```Simple Strings```的第一个字节是```'+'```，所以```Simple Strings```一定是```'+'```号开头，```CRLF```结尾，中间是内容，并且只有一行，也就是有且只有一个```CRLF```。  
最常见的```+OK\r\n```就是经典的```Simple Strings```，只有一行且满足```'+'```号开头，```CRLF```结尾，总共就5个字节。  
每种格式都一样，前面第一个标志符和最后的换行符不表示具体业务含义，对上述的```Simple Strings```来说，中间那```OK```两个字才真的具有意义。  


### Integers


## 协议实现
```RM_ReplyWithSimpleString```
```shared.ok```






